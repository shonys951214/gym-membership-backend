# 평가 가이드 플랜 수정 사항

## 핵심 메시지 반영

**초기 평가 레이더 차트는 '요약 지표'로 고정하고, 정기 평가의 상세 데이터들을 '초기 평가 항목으로 환산'해 누적 반영한다**

- 초기 평가 = 공통 언어 (6개 축 고정)
- 정기 평가 = 데이터 원천 (상세 지표 확장 가능)
- 초기 평가도 1회차 정기 평가로 취급

## 플랜 수정 사항

### 1. 2단계 평가 레이어 구조 명시

#### Layer 1: 상위 평가 축 (고정) - 레이더 차트용

**6대 영역 (절대 변경 불가)**:
1. 하체 근력 (STRENGTH)
2. 심폐 지구력 (CARDIO)
3. 근지구력 (ENDURANCE)
4. 유연성 (FLEXIBILITY)
5. 체성분 밸런스 (BODY)
6. 부상 안정성 (STABILITY)

**특징**:
- 레이더 차트 전용
- 서비스의 "공용 언어"
- 초기 평가에서 정의, 이후 변경 없음
- 모든 평가에서 동일한 기준으로 계산

#### Layer 2: 하위 상세 지표 (가변) - 그래프 차트용

**정기 평가에서 늘어나는 항목들**:
- 하체 근력: 레그프레스 10RM, 스쿼트 5RM, 데드리프트 3RM, 점프 파워, 좌/우 밸런스
- 심폐 지구력: VO2max, 러닝머신 테스트, 자전거 테스트
- 근지구력: 플랭크 시간, 푸쉬업 횟수, 버피 테스트
- 유연성: 좌전굴, 어깨 가동, 고관절 가동
- 체성분: 인바디 세부 지표
- 안정성: OHSA, Y-Balance, 한 발 서기

**특징**:
- 그래프 차트용
- 비교 분석용
- AI 분석 재료
- 확장 가능

### 2. 환산 메커니즘 추가

#### 환산 테이블 구조

정기 평가의 상세 지표를 초기 평가 축 점수로 환산하는 중간 레이어

**예시: 하체 근력 환산**
```
① 정기 평가 실측 데이터
   - 스쿼트 5RM = 체중 × 1.2 → 75점
   - 레그프레스 10RM = 체중 × 2.0 → 65점

② 지표별 점수화 (0~100)
   - 스쿼트 5RM → 75점
   - 레그프레스 10RM → 65점

③ 가중 평균 → 상위 축 반영
   하체 근력 점수 = (스쿼트 × 0.6) + (레그프레스 × 0.4) = 71점
   
➡️ 이 점수가 레이더 차트에 반영
```

### 3. 초기 평가 항목 정의

**초기 평가 항목 (레이더 차트용)**:
- 하체 근력: 스쿼트 패턴, 체어 스탠드
- 심폐 지구력: 스텝 테스트
- 근지구력: 플랭크, 푸쉬업
- 유연성: 좌전굴, 어깨 가동, 고관절 가동
- 체성분 밸런스: 인바디
- 부상 안정성: OHSA

**정기 평가 추가 항목 (그래프 차트용)**:
- 하체 근력: 스쿼트 5RM, 벤치프레스 5RM, 데드리프트 5RM (SBD)
- 기타 상세 지표들

### 4. 평가 흐름 수정

#### 초기 평가
```
1. 정적 평가 입력
2. 동적 평가 항목 입력 (초기 평가 항목만)
3. AbilitySnapshot 생성 (6개 축 점수)
4. 레이더 차트 기준선 설정
```

#### 정기 평가
```
1. 초기 평가 항목 재평가 (레이더 차트 업데이트용)
2. 상세 항목 추가 평가 (그래프 차트용)
3. 환산 규칙 적용하여 6개 축 점수 계산
4. AbilitySnapshot 생성 (초기 항목 + 상세 항목 환산)
5. 레이더 차트 업데이트 (초기 vs 현재)
```

### 5. 시각화 구조

#### 레이더 차트
- 데이터 소스: `AbilitySnapshot`
- 표시: 초기 평가(회색) vs 최근 평가(색상)
- 특징: 항상 6축 고정, 성장 추이 시각화

#### 그래프 차트
- 데이터 소스: `AssessmentItem`
- 표시: 시간별 추이 (SBD 1RM, 플랭크 시간 등)
- 특징: 상세 항목별 추이 확인

## DB 구조 안정성 평가

### 현재 구조 분석

#### ✅ 충분한 부분

1. **Assessment (평가 세션)**
   - 평가 타입 구분 (INITIAL | PERIODIC)
   - 정적/동적 평가 데이터 저장 (JSONB)
   - 확장 가능

2. **AssessmentItem (하위 상세 지표)**
   - `name` 필드로 무한 확장 가능
   - `category`로 그룹화
   - `value`, `unit`, `score` 저장
   - **확장성: 매우 높음** ✅

3. **AbilitySnapshot (상위 축 점수)**
   - 6개 축 점수 고정 저장
   - 레이더 차트 일관성 유지
   - **안정성: 매우 높음** ✅

#### ⚠️ 추가 권장 사항

1. **환산 규칙 테이블 추가** (필수)
   ```sql
   CREATE TABLE assessment_conversion_rules (
     id UUID PRIMARY KEY,
     metric_name VARCHAR(255) NOT NULL,
     category VARCHAR(50) NOT NULL,
     weight DECIMAL(3,2) NOT NULL,
     score_formula JSONB,
     is_initial_item BOOLEAN DEFAULT FALSE,
     created_at TIMESTAMP DEFAULT NOW()
   );
   ```

2. **인덱스 최적화**
   ```sql
   -- 그래프 차트용 조회 최적화
   CREATE INDEX idx_assessment_items_name 
   ON assessment_items(name);
   
   -- 환산 규칙 조회 최적화
   CREATE INDEX idx_conversion_rules_metric 
   ON assessment_conversion_rules(metric_name);
   ```

### DB 구조 안정성 결론

**현재 구조는 매우 안정적입니다.**

#### 장점

1. **확장성**: AssessmentItem의 `name` 필드로 새로운 항목 추가 가능
2. **유연성**: JSONB 필드로 추가 메타데이터 저장 가능
3. **일관성**: AbilitySnapshot으로 레이더 차트 일관성 유지
4. **이력 관리**: 모든 평가 항목이 AssessmentItem에 저장되어 이력 추적 가능

#### 개선 사항

1. **환산 규칙 테이블 추가**: 새로운 지표 추가 시 유연성 확보
2. **초기 평가 항목 정의**: 상수 파일 또는 DB 테이블로 관리
3. **인덱스 최적화**: 그래프 차트 조회 성능 향상

#### 추후 확장 가능성

**새로운 평가 항목 추가 시**:
- AssessmentItem에 새 항목 추가 (name으로 구분)
- 환산 규칙 테이블에 규칙 추가
- 기존 구조 변경 불필요 ✅

**새로운 카테고리 추가 시**:
- Category enum에 추가
- AbilitySnapshot에 필드 추가 (마이그레이션 필요)
- 환산 규칙 테이블에 규칙 추가

**결론**: 현재 DB 구조는 매우 안정적이며, 환산 규칙 테이블만 추가하면 완벽합니다.

## 플랜 업데이트 내용

### 1. 평가 체계 개요 섹션 수정

- 2단계 평가 레이어 구조 명시
- Layer 1: 상위 평가 축 (고정)
- Layer 2: 하위 상세 지표 (가변)

### 2. 초기 평가 vs 정기 평가 섹션 추가

- 초기 평가: 공통 언어 정의
- 정기 평가: 데이터 원천 + 환산
- 환산 메커니즘 설명

### 3. 환산 규칙 섹션 추가

- 환산 테이블 구조
- 환산 예시 (하체 근력)
- 구현 방법

### 4. 시각화 구조 섹션 수정

- 레이더 차트: AbilitySnapshot 기반 (6축 고정)
- 그래프 차트: AssessmentItem 기반 (상세 항목별)
- 초기 vs 현재 비교 방법

### 5. DB 구조 안정성 섹션 추가

- 현재 구조 분석
- 확장 가능성 평가
- 개선 권장 사항

