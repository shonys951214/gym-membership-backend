# 2차 개발 방향 및 우선순위

## 개요

이 문서는 능력치 평가 시스템의 2차 개발 방향과 우선순위를 정리한 문서입니다. 프론트엔드 개발자와 백엔드 개발자가 참고할 수 있도록 작성되었습니다.

## 현재 상태 (1차 개발 완료)

### ✅ 구현 완료

1. **기본 평가 시스템**
   - 초기 평가 생성 (INITIAL)
   - 정기 평가 생성 (PERIODIC)
   - 평가 항목 저장 (AssessmentItem)
   - 능력치 스냅샷 생성 (AbilitySnapshot)
   - 레이더 차트 데이터 API (`GET /api/members/[id]/abilities/hexagon`)

2. **레이더 차트 (현재 구현)**
   - 6개 축 고정 (하체 근력, 심폐 지구력, 근지구력, 유연성, 체성분 밸런스, 부상 안정성)
   - 점수 표시 (0-100점)
   - 최신 스냅샷 기준 레이더 차트 표시
   - API 응답 형식:
     ```typescript
     {
       indicators: [
         { name: "하체 근력", score: 75 },
         { name: "심폐 지구력", score: 60 },
         // ... 6개 항목
       ],
       assessedAt: "2024-03-15T10:00:00Z",
       version: "v1"
     }
     ```

3. **가중치 시스템**
   - 현재 가중치 (코드 기준):
     - 하체 근력: 25%
     - 심폐 지구력: 20%
     - 근지구력: 20%
     - 유연성: 15%
     - 체성분 밸런스: 10%
     - 부상 안정성: 10%
   - ⚠️ **수정 필요**: 플랜 기준 가중치로 변경 예정 (안정성 20%, 근력 15%, 체성분 15%, 유연성 10%)

4. **점수 계산**
   - `ScoreCalculator` 서비스를 통한 카테고리별 점수 계산
   - 종합 점수 계산 (가중치 적용)

## 2차 개발 방향

### 핵심 원칙

1. **초기 평가의 세부항목/점수환산은 추후 추가 예정**
   - 현재는 기본 평가 항목만 사용
   - 세부 항목별 점수 환산 로직은 추후 구현

2. **레이더 차트는 점수로 표시**
   - 레이더 차트에 점수(0-100) 표시
   - 초기 평가 vs 현재 평가 비교 가능하도록 확장 예정

3. **정기 평가의 세부항목/점수환산, 환산테이블은 추후 구현 예정**
   - 환산 메커니즘 설계 완료
   - 실제 구현은 추후 진행

## 개발 우선순위

### Phase 1: 가중치 수정 및 레이더 차트 개선 (최우선) ⭐

**목표**: 현재 시스템의 가중치를 플랜 기준으로 수정하고, 레이더 차트에 점수 표시 기능 추가

#### 백엔드 작업

1. **가중치 수정** (`src/common/utils/score-calculator.ts`)
   ```typescript
   // 수정 전
   const weights = {
     strength: 0.25,      // 25%
     cardio: 0.2,         // 20%
     endurance: 0.2,      // 20%
     flexibility: 0.15,   // 15%
     body: 0.1,          // 10%
     stability: 0.1,     // 10%
   };

   // 수정 후
   const weights = {
     stability: 0.2,     // 20% (최우선)
     cardio: 0.2,        // 20%
     endurance: 0.2,     // 20%
     strength: 0.15,     // 15%
     body: 0.15,        // 15%
     flexibility: 0.1,   // 10%
   };
   ```

2. **레이더 차트 API 개선** (`src/modules/assessments/assessments.service.ts`)
   - 초기 평가 스냅샷 조회 기능 추가
   - 초기 vs 현재 비교 데이터 제공
   - API 응답 형식 확장:
     ```typescript
     {
       current: {
         indicators: [...],
         assessedAt: "...",
         version: "v1"
       },
       initial: {
         indicators: [...],
         assessedAt: "...",
         version: "v1"
       },
       comparison: {
         // 증감 정보 (선택적)
       }
     }
     ```

#### 프론트엔드 작업

1. **레이더 차트 컴포넌트 개선**
   - 점수 표시 기능 추가 (각 축에 점수 숫자 표시)
   - 초기 평가 vs 현재 평가 비교 표시 (겹쳐서 표시)
   - 툴팁에 상세 정보 표시

2. **레이더 차트 스타일링**
   - 초기 평가: 회색 선 (기준선)
   - 현재 평가: 색상 선 (최신 스냅샷)
   - 점수 라벨 표시

**예상 작업 시간**: 1-2주

---

### Phase 2: 초기 평가 세부항목 정의 (중요) ⭐⭐

**목표**: 초기 평가에서 사용할 기본 평가 항목 정의 및 점수 계산 로직 구현

#### 백엔드 작업

1. **초기 평가 항목 정의**
   - 각 카테고리별 초기 평가 항목 목록 정의
   - 평가 항목별 점수 계산 기준 정의
   - 예시:
     ```typescript
     const INITIAL_ASSESSMENT_ITEMS = {
       STRENGTH: ['스쿼트 패턴', '체어 스탠드'],
       CARDIO: ['스텝 테스트'],
       ENDURANCE: ['플랭크', '푸쉬업'],
       FLEXIBILITY: ['좌전굴', '어깨 가동', '고관절 가동'],
       BODY: ['인바디'],
       STABILITY: ['OHSA']
     };
     ```

2. **점수 계산 로직 구현**
   - 각 평가 항목별 점수 계산 함수 구현
   - 연령/성별 기준표 반영 (추후 확장)
   - 카테고리별 점수 집계 로직

3. **초기 평가 검증 로직**
   - 필수 평가 항목 체크
   - 평가 항목 완성도 검증

#### 프론트엔드 작업

1. **초기 평가 입력 폼 개선**
   - 카테고리별 평가 항목 입력 UI
   - 필수 항목 표시
   - 입력값 검증

2. **초기 평가 완성도 표시**
   - 진행률 표시
   - 미완성 항목 안내

**예상 작업 시간**: 2-3주

---

### Phase 3: 정기 평가 세부항목 및 환산 메커니즘 (중요) ⭐⭐⭐

**목표**: 정기 평가에서 상세 항목 추가 및 환산 메커니즘 구현

#### 백엔드 작업

1. **환산 규칙 테이블 생성** (DB 마이그레이션)
   ```sql
   CREATE TABLE assessment_conversion_rules (
     id UUID PRIMARY KEY,
     metric_name VARCHAR(255) NOT NULL,  -- "스쿼트 5RM", "플랭크" 등
     category VARCHAR(50) NOT NULL,      -- STRENGTH, CARDIO, etc.
     weight DECIMAL(3,2) NOT NULL,       -- 가중치 (0~1)
     score_formula JSONB,                 -- 점수 계산 공식
     is_initial_item BOOLEAN DEFAULT FALSE, -- 초기 평가 항목 여부
     created_at TIMESTAMP DEFAULT NOW()
   );
   ```

2. **환산 서비스 구현**
   - 정기 평가 상세 항목 → 초기 평가 축 점수 환산 로직
   - 환산 규칙 조회 및 적용
   - 가중 평균 계산

3. **정기 평가 항목 확장**
   - SBD 1RM 측정 항목 추가 (조건부)
   - 기타 상세 지표 추가

4. **정기 평가 API 개선**
   - 초기 평가 항목 재평가
   - 상세 항목 추가 평가
   - 환산된 점수로 AbilitySnapshot 업데이트

#### 프론트엔드 작업

1. **정기 평가 입력 폼 확장**
   - 초기 평가 항목 재평가 섹션
   - 상세 항목 추가 섹션
   - SBD 1RM 입력 UI (조건부 표시)

2. **그래프 차트 컴포넌트 구현**
   - 상세 항목별 시간별 추이 그래프
   - SBD 1RM 추이 그래프
   - 초기 평가 항목 vs 상세 항목 비교

**예상 작업 시간**: 3-4주

---

### Phase 4: 그래프 차트 및 상세 시각화 (중요) ⭐⭐

**목표**: 상세 항목별 그래프 차트 구현 및 시각화 개선

#### 백엔드 작업

1. **그래프 차트 데이터 API**
   - 상세 항목별 시간별 데이터 조회
   - SBD 1RM 추이 데이터
   - 초기 평가 항목 추이 데이터

2. **데이터 집계 및 포맷팅**
   - 시간별 데이터 집계
   - 차트에 바로 사용 가능한 형식 제공

#### 프론트엔드 작업

1. **라인 차트 컴포넌트 구현**
   - 상세 항목별 시간별 추이
   - 여러 항목 비교 가능
   - 초기 평가 항목 vs 상세 항목 비교

2. **그래프 차트 페이지 구현**
   - 레이더 차트와 그래프 차트 통합 페이지
   - 탭 또는 섹션으로 구분
   - 필터링 기능 (항목별, 기간별)

**예상 작업 시간**: 2-3주

---

### Phase 5: 평가 기준표 및 등급 체계 (선택적) ⭐

**목표**: 연령/성별별 평가 기준표 구현 및 등급 체계 적용

#### 백엔드 작업

1. **평가 기준표 테이블 생성**
   ```sql
   CREATE TABLE assessment_standards (
     id UUID PRIMARY KEY,
     category VARCHAR(50) NOT NULL,
     item_name VARCHAR(255) NOT NULL,
     age_range VARCHAR(20),  -- "20-29", "30-39" 등
     gender VARCHAR(10),    -- "MALE", "FEMALE"
     grade VARCHAR(10),      -- "상", "중", "하"
     min_value DECIMAL(10,2),
     max_value DECIMAL(10,2),
     created_at TIMESTAMP DEFAULT NOW()
   );
   ```

2. **등급 계산 로직**
   - 점수 → 등급 변환 (S/A/B/C/D 또는 상/중/하)
   - 부상 안정성 특별 등급 (O/△/X)

#### 프론트엔드 작업

1. **등급 표시 UI**
   - 레이더 차트에 등급 표시
   - 평가 상세 페이지에 등급 표시
   - 등급별 색상 구분

**예상 작업 시간**: 2주

---

## 개발 시 주의사항

### 백엔드

1. **점수 계산 로직**
   - 모든 점수는 0-100 범위로 정규화
   - null/undefined 값 처리 (기본값 0)
   - 가중치 합계는 항상 1.0

2. **데이터 무결성**
   - 초기 평가는 1개만 존재 (soft delete 고려)
   - 정기 평가는 여러 개 가능
   - AbilitySnapshot은 항상 Assessment와 연결

3. **API 응답 형식**
   - 일관된 응답 형식 유지
   - 에러 처리 명확히
   - Swagger 문서 업데이트

### 프론트엔드

1. **레이더 차트**
   - 점수 표시는 백엔드에서 계산된 값만 사용
   - 프론트엔드에서 점수 계산 금지
   - 초기 평가 vs 현재 평가 비교 시 색상 구분

2. **그래프 차트**
   - 백엔드에서 정렬·가공된 데이터만 사용
   - 프론트엔드에서 데이터 가공 금지
   - 시간축 정렬 확인

3. **에러 처리**
   - 평가 데이터가 없을 때 기본값 표시
   - API 에러 시 사용자 친화적 메시지

## 데이터 구조

### 현재 구조

```
Assessment (평가 세션)
├── AssessmentItem (평가 항목)
│   ├── category (STRENGTH, CARDIO, etc.)
│   ├── name (항목 이름)
│   ├── value (측정값)
│   ├── unit (단위)
│   └── score (점수)
└── AbilitySnapshot (능력치 스냅샷)
    ├── strengthScore
    ├── cardioScore
    ├── enduranceScore
    ├── flexibilityScore
    ├── bodyScore
    ├── stabilityScore
    └── totalScore
```

### 추후 확장 구조

```
Assessment (평가 세션)
├── AssessmentItem (평가 항목)
│   ├── category
│   ├── name
│   ├── value
│   ├── unit
│   ├── score
│   └── isInitialItem (초기 평가 항목 여부) ⭐ 추가 예정
├── AbilitySnapshot (능력치 스냅샷)
└── AssessmentConversionRule (환산 규칙) ⭐ 추가 예정
    ├── metric_name
    ├── category
    ├── weight
    └── score_formula
```

## API 엔드포인트 (현재 + 추후)

### 현재 구현된 API

- `GET /api/members/:id/abilities/hexagon` - 레이더 차트 데이터
- `GET /api/members/:id/assessments` - 평가 목록
- `GET /api/members/:id/assessments/:assessmentId` - 평가 상세
- `POST /api/members/:id/assessments` - 평가 생성
- `PATCH /api/members/:id/assessments/:assessmentId` - 평가 수정

### 추후 추가 예정 API

- `GET /api/members/:id/abilities/hexagon/compare` - 초기 vs 현재 비교
- `GET /api/members/:id/abilities/graph/:itemName` - 상세 항목별 그래프 데이터
- `GET /api/members/:id/assessments/initial` - 초기 평가 조회
- `GET /api/assessment-conversion-rules` - 환산 규칙 조회 (관리자용)

## 프론트엔드 컴포넌트 구조 (추후)

```
components/abilities/
├── AbilityRadarChart.tsx        # 레이더 차트 (점수 표시)
├── AbilityLineChart.tsx          # 라인 차트 (상세 항목별)
├── AbilityComparison.tsx         # 초기 vs 현재 비교
├── AssessmentForm.tsx           # 평가 입력 폼
│   ├── InitialAssessmentForm.tsx
│   └── PeriodicAssessmentForm.tsx
└── AssessmentDetail.tsx         # 평가 상세 페이지
```

## 참고 문서

- [ASSESSMENT_GUIDE.md](ASSESSMENT_GUIDE.md) - 평가 가이드 문서 (작성 예정)
- [ASSESSMENT_2LAYER_STRUCTURE.md](ASSESSMENT_2LAYER_STRUCTURE.md) - 2단계 평가 레이어 구조
- [PLAN_PROJECT_ALIGNMENT.md](PLAN_PROJECT_ALIGNMENT.md) - 프로젝트 구조 정렬 가이드

## 문의 및 피드백

개발 중 질문이나 이슈가 있으면 백엔드 개발자에게 문의하세요.

