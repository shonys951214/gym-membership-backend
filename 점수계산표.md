# 평가 점수 계산표

> **목적**: 평가 시스템의 점수 계산 방식을 러프하게 정리한 문서  
> 프론트엔드 개발자와 백엔드 개발자가 점수 산정 로직을 이해하기 위한 참고 자료

---

## 📊 전체 점수 산정 구조

### 카테고리별 최대 점수 및 가중치

| 카테고리 | 축 최대값 | 종합 점수 가중치 | 설명 |
|---------|----------|-----------------|------|
| **안정성** | 20 | 20% | 부상 안정성 (최우선) |
| **심폐 지구력** | 20 | 20% | 유산소 능력 |
| **근지구력** | 20 | 20% | 근육 지구력 |
| **하체 근력** | 15 | 15% | 하체 근력 |
| **체성분** | 15 | 15% | 체성분 밸런스 |
| **유연성** | 10 | 10% | 유연성 |

**총합**: 100 (레이더 차트 축 최대값)  
**종합 점수 가중치 총합**: 100%

### 점수 범위

- **카테고리별 점수**: 0 ~ 100점 (내부 점수 기준)
- **종합 점수**: 0 ~ 100점 (가중 평균)
- **레이더 차트 표시**: 카테고리별 점수 × 0.85 (시각적 표현)

---

## 1️⃣ 하체 근력 점수 계산 (최대 15점 가중치)

### 입력 → 등급 → 내부 점수 변환

| 입력 | 최종 등급 | 내부 점수 | 설명 |
|------|----------|----------|------|
| A | 안정적 | **80** | 안정적으로 반복 수행 |
| B | 무난함 | **60** | 수행 가능, 깊이·정렬 일부 제한 |
| C | 제한 있음 | **45** | 수행 가능하나 불안정 / 연속 어려움 |
| D-1 | 제한 있음 | **30** | 체어/박스 스쿼트 가능 |
| D-2 | 준비 필요 | **20** | 보조 있어도 어려움 |

### 계산 예시

**예시 1**: 사용자가 "A" 입력
```
입력: grade = "A"
→ 내부 점수: 80점
→ 최종 등급: "안정적"
```

**예시 2**: 사용자가 "D" 선택 후 "D-1" 입력
```
입력: grade = "D-1"
→ 내부 점수: 30점
→ 최종 등급: "제한 있음"
```

---

## 2️⃣ 심폐 지구력 점수 계산 (최대 20점 가중치)

### 입력 → 등급 → 내부 점수 변환

| 입력 | 최종 등급 | 내부 점수 | 설명 |
|------|----------|----------|------|
| A | 안정적 | **80** | 리듬 유지 + 완주 |
| B + 회복 빠름 | 무난함 | **65** | 리듬 유지 (1분 이내 호흡 편안) |
| B + 회복 느림 | 무난함 | **55** | 리듬 유지 (2분 이상 호흡 불편) |
| B (회복 속도 없음) | 무난함 | **60** | 기본값 (평균) |
| C | 제한 있음 | **40** | 조기 중단 / 리듬 붕괴 |
| IMPOSSIBLE | 준비 필요 | **20** | 테스트 거의 불가 |

### 계산 예시

**예시 1**: 사용자가 "A" 입력
```
입력: grade = "A"
→ 내부 점수: 80점
→ 최종 등급: "안정적"
```

**예시 2**: 사용자가 "B" 선택 + "회복 빠름" 체크
```
입력: 
  grade = "B"
  recoverySpeed = ["fast"]
→ 내부 점수: 65점
→ 최종 등급: "무난함"
```

**예시 3**: 사용자가 "B" 선택 + "회복 느림" 체크
```
입력:
  grade = "B"
  recoverySpeed = ["slow"]
→ 내부 점수: 55점
→ 최종 등급: "무난함"
```

---

## 3️⃣ 근지구력 점수 계산 (최대 20점 가중치)

### 입력 → 등급 → 내부 점수 변환

| 입력 | 최종 등급 | 내부 점수 | 설명 |
|------|----------|----------|------|
| A | 안정적 | **80** | 자세 안정, 흔들림 거의 없음 |
| B | 무난함 | **60** | 유지 가능하나 흔들림 있음 |
| C | 제한 있음 | **40** | 빠른 붕괴 / 중단 |
| IMPOSSIBLE | 준비 필요 | **20** | 거의 유지 불가 |

### 계산 예시

**예시 1**: 사용자가 "A" 입력
```
입력: grade = "A"
→ 내부 점수: 80점
→ 최종 등급: "안정적"
```

**예시 2**: 사용자가 "B" 입력
```
입력: grade = "B"
→ 내부 점수: 60점
→ 최종 등급: "무난함"
```

---

## 4️⃣ 유연성 점수 계산 (최대 10점 가중치)

### 항목별 가중치

| 항목 | 가중치 | 중요도 |
|------|--------|--------|
| 어깨 가동성 | 1.3 | 중요 |
| 고관절 가동성 | 1.2 | 중요 |
| 좌전굴 | 1.0 | 기준 |
| 햄스트링 | 0.8 | 보조 |

### 계산 로직

1. 각 항목별 등급 입력 (A, B, C)
2. **C 등급만** 가중치 합산
3. 가중치 합 범위로 최종 등급 판정

### 가중치 합 → 등급 → 내부 점수 변환

| 가중치 합 | 최종 등급 | 내부 점수 | 설명 |
|----------|----------|----------|------|
| 0 | 안정적 | **80** | C 등급 없음 (모두 A 또는 B) |
| 1.0 ~ 1.5 | 무난함 | **60** | 경미한 제한 |
| 1.6 ~ 2.5 | 제한 있음 | **40** | 중간 정도 제한 |
| 2.6 이상 | 준비 필요 | **20** | 명확한 제한 다수 |

### 계산 예시

**예시 1**: 어깨 C(1.3) + 좌전굴 C(1.0) = 2.3
```
입력:
  flexibilityItems = {
    shoulder: "C",      // 가중치 1.3
    sitAndReach: "C",   // 가중치 1.0
    hip: "A",           // C 아니므로 제외
    hamstring: "B"      // C 아니므로 제외
  }
→ 가중치 합: 1.3 + 1.0 = 2.3
→ 범위: 1.6 ~ 2.5
→ 내부 점수: 40점
→ 최종 등급: "제한 있음"
```

**예시 2**: 고관절 C(1.2)만 = 1.2
```
입력:
  flexibilityItems = {
    hip: "C",           // 가중치 1.2
    shoulder: "A",
    sitAndReach: "A",
    hamstring: "A"
  }
→ 가중치 합: 1.2
→ 범위: 1.0 ~ 1.5
→ 내부 점수: 60점
→ 최종 등급: "무난함"
```

**예시 3**: 어깨 C(1.3) + 고관절 C(1.2) + 좌전굴 C(1.0) = 3.5
```
입력:
  flexibilityItems = {
    shoulder: "C",      // 가중치 1.3
    hip: "C",           // 가중치 1.2
    sitAndReach: "C",   // 가중치 1.0
    hamstring: "A"
  }
→ 가중치 합: 1.3 + 1.2 + 1.0 = 3.5
→ 범위: 2.6 이상
→ 내부 점수: 20점
→ 최종 등급: "준비 필요"
```

---

## 5️⃣ 체성분 점수 계산 (최대 15점 가중치)

### 연령대별 기준 (DB에서 조회)

**남성 기준**:
| 연령대 | 체지방률 적정 | 골격근량 충분 |
|--------|--------------|-------------|
| 20-30대 | 10-18% | 42% 이상 |
| 30-40대 | 12-20% | 40% 이상 |
| 40-50대 | 15-22% | 38% 이상 |
| 50대 이상 | 18-25% | 35% 이상 |

**여성 기준**:
| 연령대 | 체지방률 적정 | 골격근량 충분 |
|--------|--------------|-------------|
| 20-30대 | 18-25% | 32% 이상 |
| 30-40대 | 20-28% | 30% 이상 |
| 40-50대 | 23-30% | 28% 이상 |
| 50대 이상 | 25-33% | 26% 이상 |

### 상태 조합 → 등급 → 내부 점수 변환

| 상태 조합 | 최종 등급 | 내부 점수 | 설명 |
|----------|----------|----------|------|
| 근육 충분 + 지방 적정 | 안정적 | **80** | 양쪽 모두 기준 충족 |
| 한 요소 관리 필요 | 무난함 | **60** | 근육 또는 지방 중 하나만 기준 충족 |
| 지방 과다 또는 근육 부족 | 제한 있음 | **40** | 한 요소가 명확히 기준 미충족 |
| 둘 다 불리 | 준비 필요 | **20** | 양쪽 모두 기준 미충족 |

### 계산 예시

**예시 1**: 남성, 35세, 체중 70kg
```
입력:
  age = 35
  gender = "MALE"
  bodyWeight = 70kg
  muscleMass = 30kg (골격근량)
  bodyFatPercentage = 15% (체지방률)

→ 연령대 기준 조회: 30-40대 남성 (체지방률 12-20%, 골격근량 40% 이상)
→ 골격근량 % 계산: (30 / 70) × 100 = 42.9%
→ 체지방률 15%: 적정 범위 (12-20%) ✅
→ 골격근량 42.9%: 충분 기준 (40% 이상) ✅
→ 상태: 근육 충분 + 지방 적정
→ 내부 점수: 80점
→ 최종 등급: "안정적"
```

**예시 2**: 여성, 45세, 체중 60kg
```
입력:
  age = 45
  gender = "FEMALE"
  bodyWeight = 60kg
  muscleMass = 15kg (골격근량)
  bodyFatPercentage = 25% (체지방률)

→ 연령대 기준 조회: 40-50대 여성 (체지방률 23-30%, 골격근량 28% 이상)
→ 골격근량 % 계산: (15 / 60) × 100 = 25%
→ 체지방률 25%: 적정 범위 (23-30%) ✅
→ 골격근량 25%: 기준 미충족 (28% 이상 필요) ❌
→ 상태: 한 요소 관리 필요
→ 내부 점수: 60점
→ 최종 등급: "무난함"
```

---

## 6️⃣ 안정성 점수 계산 (최대 20점 가중치)

### OHSA + 통증 조합 → 등급 → 내부 점수 변환

| OHSA | 통증 | 최종 등급 | 내부 점수 | 설명 |
|------|------|----------|----------|------|
| A | 없음 | 안정적 | **80** | 부상 거의 없음 + 통증 없음 |
| B | 없음 | 무난함 | **60** | 경미한 부상 + 통증 없음 |
| C | 없음 | 제한 있음 | **40** | 명확한 부상 + 통증 없음 |
| A | 있음 | 제한 있음 | **50** | 부상 거의 없으나 통증 있음 |
| B | 있음 | 제한 있음 | **45** | 경미한 부상 + 통증 있음 |
| C | 있음 | 준비 필요 | **20** | 명확한 부상 + 통증 있음 |

### 계산 예시

**예시 1**: OHSA A + 통증 없음
```
입력:
  ohsa = "A"
  pain = "none"
→ 내부 점수: 80점
→ 최종 등급: "안정적"
```

**예시 2**: OHSA B + 통증 있음
```
입력:
  ohsa = "B"
  pain = "present"
→ 내부 점수: 45점
→ 최종 등급: "제한 있음"
```

**예시 3**: OHSA C + 통증 있음
```
입력:
  ohsa = "C"
  pain = "present"
→ 내부 점수: 20점
→ 최종 등급: "준비 필요"
```

---

## 7️⃣ 종합 점수 계산

### 가중 평균 방식

**가중치**:
- 안정성: 20%
- 심폐 지구력: 20%
- 근지구력: 20%
- 하체 근력: 15%
- 체성분: 15%
- 유연성: 10%

### 계산 공식

```
종합 점수 = (안정성 × 0.2) + (심폐 지구력 × 0.2) + (근지구력 × 0.2) 
         + (하체 근력 × 0.15) + (체성분 × 0.15) + (유연성 × 0.1)
```

**⚠️ 주의**: 
- `null` 값인 카테고리는 제외하고 계산
- 가중치도 해당 카테고리만큼 제외하여 정규화

### 계산 예시

**예시 1**: 모든 카테고리 입력된 경우

```
카테고리별 점수:
- 안정성: 80점
- 심폐 지구력: 65점
- 근지구력: 60점
- 하체 근력: 60점
- 체성분: 80점
- 유연성: 60점

종합 점수 계산:
= (80 × 0.2) + (65 × 0.2) + (60 × 0.2) + (60 × 0.15) + (80 × 0.15) + (60 × 0.1)
= 16 + 13 + 12 + 9 + 12 + 6
= 68점
```

**예시 2**: 일부 카테고리 null인 경우 (유연성 제외)

```
카테고리별 점수:
- 안정성: 80점
- 심폐 지구력: 65점
- 근지구력: 60점
- 하체 근력: 60점
- 체성분: 80점
- 유연성: null (입력 없음)

유효 가중치 합: 0.2 + 0.2 + 0.2 + 0.15 + 0.15 = 0.9

종합 점수 계산:
= [(80 × 0.2) + (65 × 0.2) + (60 × 0.2) + (60 × 0.15) + (80 × 0.15)] / 0.9
= (16 + 13 + 12 + 9 + 12) / 0.9
= 62 / 0.9
≈ 68.9점
```

---

## 8️⃣ 레이더 차트 표시

### 축 최대값

| 카테고리 | 축 최대값 |
|---------|----------|
| 안정성 | 20 |
| 심폐 지구력 | 20 |
| 근지구력 | 20 |
| 하체 근력 | 15 |
| 체성분 | 15 |
| 유연성 | 10 |

### 표시 값 계산

```
레이더 차트 표시 값 = 카테고리별 내부 점수 × 0.85
```

### 예시

**카테고리별 내부 점수**:
- 안정성: 80점 → 레이더 표시: 80 × 0.85 = **68**
- 심폐 지구력: 65점 → 레이더 표시: 65 × 0.85 = **55.25**
- 근지구력: 60점 → 레이더 표시: 60 × 0.85 = **51**
- 하체 근력: 60점 → 레이더 표시: 60 × 0.85 = **51**
- 체성분: 80점 → 레이더 표시: 80 × 0.85 = **68**
- 유연성: 60점 → 레이더 표시: 60 × 0.85 = **51**

---

## 9️⃣ 전체 계산 흐름 요약

### 단계별 처리 순서

1. **프론트엔드 입력**
   - 사용자가 등급 선택 (A, B, C 등)
   - 또는 상세 데이터 입력 (체성분 수치, 유연성 항목별 등급 등)

2. **백엔드 등급 → 점수 변환**
   - `GradeScoreConverter` 서비스가 각 카테고리별로 변환 로직 실행
   - DB 테이블에서 기준 조회 (체성분, 유연성 가중치 등)
   - 내부 점수 (0-100) 계산

3. **카테고리별 점수 계산**
   - 동일 카테고리 내 여러 항목이 있을 경우 가중 평균 (현재는 단일 항목만 사용)
   - 부상 제한 영역 제외 처리

4. **종합 점수 계산**
   - 가중 평균으로 종합 점수 계산
   - null 값 제외 및 가중치 정규화

5. **스냅샷 저장**
   - `ability_snapshots` 테이블에 저장
   - 버전 정보 포함 (`version: "v1"`)

6. **레이더 차트 표시**
   - 프론트엔드에서 카테고리별 점수 × 0.85 적용
   - 축 최대값 기준으로 표시

---

## 🔍 참고사항

### 내부 점수 vs 최종 등급

- **내부 점수**: DB 계산용, 0-100 범위
- **최종 등급**: UI 표시용 ("안정적", "무난함", "제한 있음", "준비 필요")
- 프론트엔드는 등급만 표시하되, 레이더 차트에는 내부 점수 × 0.85 사용

### 점수 계산 버전

- 현재 버전: `v1`
- `ability_snapshots.version` 필드에 저장
- 점수 계산 로직 변경 시 버전 업데이트 필요

### null 처리

- 카테고리별 점수가 `null`인 경우:
  - 종합 점수 계산 시 제외
  - 레이더 차트에서도 제외 (해당 축 표시 안 함)
  - 부상 제한 영역이나 입력 누락 시 발생

---

## 📝 변경 이력

- 2024-01-XX: 초안 작성
- 점수 계산 로직 변경 시 이 문서도 함께 업데이트 필요
