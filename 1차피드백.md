# 1차 피드백 반영 및 후속 논의 내용

## 📋 피드백 요약

### 추가 요청 기능

1. **목표 관리 기능**: 회원의 목표 한줄 요약, 달성률/진행률, 트레이너 코멘트
2. **추천 운동 루틴 기능**: 오늘의 운동 루틴
3. **운동 기록 기능**: 어떤 운동을 언제 몇 키로를 몇 회 했는지 기록
4. **대시보드 개선**:
    - 목표: 회원의 목표, 동기부여 코멘트, 진행률
    - 수업회차: 수업회차 표기 (ex. 50% 10회/20회 + 막대그래프), 클릭시 주요 수업내용 확인
    - 운동캘린더: 달력에 PT참여, 개인운동 참여 표기
    - 운동기록분석: 부위별 운동 볼륨 확인 (주간, 월간)
5. **평가 시스템 개선**: 정적평가와 동적평가로 구분, 평가 항목 세분화

### 주요 우려사항

- 회원 평가를 할 수 있는 물리적 시간이 한정적임 (1시간 안에 평가할 수 있는 핵심 항목을 최소화)
- 점수화하여 표현하는 건 좋은데 구체적으로 어떤 가중치를 만들어 등급을 나누어 평가할 지 의문
- 평가를 크게 두개로 나누고 세분화하면 될 것 같음 (평가의 위계)

---

## 🔍 피드백 이후 논의 내용

### 1. 가중치 및 등급 시스템 설계

#### 1-1. 현재 시스템 분석

- **현재 상태**: 가중치가 하드코딩됨 (근력 30%, 심폐 25%, 지구력 20%, 신체 15%, 안정성 10%)
- **문제점**: 등급 시스템 없음, 트레이너 커스터마이징 불가

#### 1-2. 개선 방안

##### 가중치 설정 커스터마이징

**필요한 엔티티**: `AssessmentWeightConfig`

- 전역 기본 설정: 모든 트레이너가 공통 사용
- 개인 설정: 특정 트레이너가 자신만의 가중치 설정 가능
- 기본 가중치 제안:
    - 하체 근력: 25%
    - 심폐 지구력: 20%
    - 근지구력: 20%
    - 유연성: 15% (새로 추가 필요)
    - 체성분 밸런스: 10%
    - 부상 안정성: 10%

##### 등급 시스템 설계

**필요한 엔티티**: `AssessmentGradeConfig`

- 종합 점수 등급:
    - 우수 (EXCELLENT): 90-100점
    - 양호 (GOOD): 80-89점
    - 보통 (NORMAL): 70-79점
    - 미흡 (POOR): 60-69점
    - 매우 미흡 (VERY_POOR): 0-59점
- 트레이너별 등급 기준 커스터마이징 가능

##### 측정값 → 점수 변환 기준표

**필요한 엔티티**: `ScoringCriteria`

- 운동별 평가 기준표 설정 (예: 스쿼트 1RM 기준)
- 측정값 범위별 점수 매핑
- 트레이너별 커스터마이징 가능

#### 1-3. 트레이너 커스터마이징 시나리오

**시나리오 1: 가중치 조정**

- 근력 중심 프로그램: 근력 40%, 심폐 20%, 지구력 15%, 유연성 10%, 체성분 10%, 안정성 5%

**시나리오 2: 등급 기준 조정**

- 더 엄격한 기준: 우수 95-100, 양호 85-94, 보통 75-84, 미흡 65-74, 매우 미흡 0-64

**시나리오 3: 평가 기준표 커스터마이징**

- 트레이너별 스쿼트 평가 기준 설정 가능

---

### 2. 평가 시스템 개선 (정적/동적 평가 구분)

#### 2-1. 평가 위계 구조

**1. 정적평가 (STATIC)**

- 설문조사
- 체성분 평가 (인바디)
- 육안체형평가 (앞, 옆, 뒷 모습 촬영하여 불균형 체크)

**2. 동적평가 (DYNAMIC)**

- 유연성 평가
- 근력 평가
- 밸런스 평가
- 유산소성 평가

#### 2-2. Assessment 엔티티 확장 필요

- `evaluationType`: enum ('STATIC' | 'DYNAMIC')
- `staticEvaluation`: jsonb (정적평가 데이터)
- `dynamicEvaluation`: jsonb (동적평가 데이터)

---

### 3. 구현 계획

#### Phase 1: 기본 기능 엔티티 및 API (최우선)

1. Member 엔티티에 목표 필드 추가
    - `goal`, `goalProgress`, `goalTrainerComment`, `totalSessions`, `completedSessions`
2. WorkoutRecord 엔티티 생성 (운동 기록)
3. PTSession 엔티티 생성 (PT 세션 관리)
4. WorkoutRoutine 엔티티 생성 (추천 운동 루틴)
5. 목표 관리 API 구현
6. 운동 기록 API 구현
7. PT 세션 API 구현
8. 추천 운동 루틴 API 구현

#### Phase 2: 대시보드 통합

1. 대시보드 API 확장
    - 목표 정보 통합
    - 수업 진행률 통합
    - 운동 캘린더 데이터 통합
    - 운동 기록 분석 통합 (주간/월간)

#### Phase 3: 점수 계산 로직 확장 가능하게 설계 (DB 구조 설계, 기본값 사용)

1. ScoringCriteria 엔티티 생성 (기본 운동 기준표로 채움)
    - 운동별 평가 기준표 구조 설계
    - 체중 대비 비율 계산 지원 구조 설계
    - 기본 운동 기준표 데이터 입력 (스쿼트, 벤치프레스 등)
2. AssessmentWeightConfig 엔티티 생성 (기본 가중치로 채움)
    - 가중치 설정 테이블 구조 설계
    - 전역 기본 가중치 데이터 입력
3. AssessmentGradeConfig 엔티티 생성 (기본 등급 기준으로 채움)
    - 등급 기준 테이블 구조 설계
    - 전역 기본 등급 기준 데이터 입력
4. 점수 계산 로직을 DB 조회 방식으로 변경
    - ScoringCriteria 기반 측정값 → 점수 변환 로직 구현
    - 체중 대비 비율 계산 로직 구현
    - 가중치 설정 기반 종합 점수 계산 로직 구현
    - 등급 계산 로직 구현
    - **중요**: 기본값 사용, 커스터마이징 UI/API는 나중에 구현

#### Phase 4: 평가 시스템 개선

1. Assessment 엔티티 확장 (정적/동적 평가 구분)
    - `evaluationType`: enum ('STATIC' | 'DYNAMIC')
    - `staticEvaluation`: jsonb (정적평가 데이터)
    - `dynamicEvaluation`: jsonb (동적평가 데이터)
2. 평가 타입 구분 로직 구현
3. 정적평가/동적평가별 데이터 구조 설계

#### Phase 5: 가중치/등급 커스터마이징 UI/API (정보 수집 후 구현)

1. 가중치 설정 API 구현 (트레이너별 커스터마이징)
2. 등급 기준 설정 API 구현 (트레이너별 커스터마이징)
3. 평가 기준표 관리 API 구현 (트레이너별 커스터마이징)
4. 커스터마이징 UI 구현 (프론트엔드)

---

## 📝 상세 설계 내용

### 가중치 설정 엔티티 구조

```typescript
@Entity("assessment_weight_configs")
export class AssessmentWeightConfig {
	id: string;
	userId?: string; // null이면 전역 설정
	categoryWeights: {
		STRENGTH: number; // 기본값: 0.25
		CARDIO: number; // 기본값: 0.20
		ENDURANCE: number; // 기본값: 0.20
		FLEXIBILITY: number; // 기본값: 0.15 (새로 추가)
		BODY: number; // 기본값: 0.10
		STABILITY: number; // 기본값: 0.10
	};
	isDefault: boolean;
}
```

### 등급 기준 엔티티 구조

```typescript
@Entity("assessment_grade_configs")
export class AssessmentGradeConfig {
	id: string;
	userId?: string; // null이면 전역 설정
	gradeRanges: {
		totalScore: {
			EXCELLENT: { min: 90; max: 100 };
			GOOD: { min: 80; max: 89 };
			NORMAL: { min: 70; max: 79 };
			POOR: { min: 60; max: 69 };
			VERY_POOR: { min: 0; max: 59 };
		};
	};
	gradeLabels: {
		EXCELLENT: "우수";
		GOOD: "양호";
		NORMAL: "보통";
		POOR: "미흡";
		VERY_POOR: "매우 미흡";
	};
	isDefault: boolean;
}
```

### 평가 기준표 엔티티 구조

```typescript
@Entity("scoring_criteria")
export class ScoringCriteria {
	id: string;
	userId?: string; // null이면 전역 설정 (Phase 3에서는 기본값만 사용)
	category: Category;
	exerciseName: string; // "스쿼트", "벤치프레스" 등
	calculationType: "ABSOLUTE" | "BODY_WEIGHT_RATIO"; // 절대값 또는 체중 대비 비율
	scoringRanges: Array<{
		minValue?: number; // 절대값 또는 비율 (0.75 = 체중의 0.75배)
		maxValue?: number;
		score: number; // 0-100
		label?: string; // "초보", "입문", "중급", "상급", "엘리트" 등
	}>;
	unit: string; // "kg", "배", "ml/kg/min" 등
	isDefault: boolean;
}
```

**예시 데이터 (스쿼트 - 체중 대비 1RM)**:

```json
{
	"category": "STRENGTH",
	"exerciseName": "스쿼트",
	"calculationType": "BODY_WEIGHT_RATIO",
	"scoringRanges": [
		{ "minValue": 0, "maxValue": 0.75, "score": 40, "label": "초보" },
		{ "minValue": 0.75, "maxValue": 1.0, "score": 55, "label": "입문" },
		{ "minValue": 1.0, "maxValue": 1.3, "score": 70, "label": "중급" },
		{ "minValue": 1.3, "maxValue": 1.6, "score": 85, "label": "상급" },
		{ "minValue": 1.6, "maxValue": 999, "score": 95, "label": "엘리트" }
	],
	"unit": "배",
	"isDefault": true
}
```

---

## 🎯 구현 우선순위

### 최우선 (기본 기능 - 즉시 구현)

1. 목표 관리 기능 (회원 목표, 진행률, 트레이너 코멘트)
2. 운동 기록 기능 (운동별 기록, 볼륨 계산)
3. PT 세션 관리 (수업 회차, 주요 내용)
4. 추천 운동 루틴 (오늘의 운동 루틴)

### 2순위 (대시보드 통합)

5. 대시보드 API 확장 (목표, 수업 진행률, 운동 캘린더, 운동 기록 분석 통합)

### 3순위 (점수 계산 로직 확장 설계 - DB 구조만, 기본값 사용)

6. ScoringCriteria 엔티티 생성 및 기본 운동 기준표 입력
7. AssessmentWeightConfig 엔티티 생성 및 기본 가중치 입력
8. AssessmentGradeConfig 엔티티 생성 및 기본 등급 기준 입력
9. 점수 계산 로직을 DB 조회 방식으로 변경 (기본값 사용)
    - 체중 대비 비율 계산 로직 구현
    - 운동별 평가 기준표 기반 점수 변환

### 4순위 (평가 시스템 개선)

10. 정적/동적 평가 구분
11. 평가 항목 세분화

### 5순위 (커스터마이징 - 정보 수집 후 구현)

12. 가중치 설정 API (트레이너별 커스터마이징)
13. 등급 기준 설정 API (트레이너별 커스터마이징)
14. 평가 기준표 관리 API (트레이너별 커스터마이징)
15. 커스터마이징 UI (프론트엔드)

---

## 📌 주요 결정 사항

1. **6가지 영역 평가**: 하체 근력, 심폐 지구력, 근지구력, 유연성, 체성분 밸런스, 부상 안정성
    - 기존 5개 영역에서 **유연성(FLEXIBILITY)** 추가 필요

2. **가중치 기본값**:
    - 근력 25%, 심폐 20%, 지구력 20%, 유연성 15%, 체성분 10%, 안정성 10%
    - Phase 3에서 DB에 기본값으로 저장, Phase 5에서 커스터마이징 가능

3. **등급 시스템**: 5단계 등급 (우수, 양호, 보통, 미흡, 매우 미흡)
    - Phase 3에서 DB에 기본 기준으로 저장, Phase 5에서 커스터마이징 가능

4. **점수 계산 로직 설계 원칙**:
    - **확장 가능한 구조로 설계**: 운동별 평가 기준표를 DB에 저장
    - **체중 대비 비율 계산 지원**: 스쿼트 등 체중 대비 1RM 평가 지원
    - **기본값 우선 사용**: Phase 3에서는 기본 운동 기준표만 사용
    - **커스터마이징은 후순위**: 트레이너별 커스터마이징은 정보 수집 후 구현 (Phase 5)

5. **트레이너 커스터마이징**:
    - 가중치, 등급 기준, 평가 기준표 모두 커스터마이징 가능 (Phase 5)
    - 전역 기본값 + 개인 설정 구조
    - **중요**: 정보 수집 및 정교한 계산표 확보 후 구현

6. **평가 주기**:
    - 상시 평가 (주간/월간/분기 개념 제거, 히스토리 관리 중심)

7. **구현 전략**:
    - 기본 기능(목표, 운동 기록, PT 세션, 대시보드)을 먼저 완성
    - 점수 계산 로직은 확장 가능하게 설계하되, 기본값 사용
    - 가중치/등급 커스터마이징은 정보 수집 후 구현

---

## 🔧 확장 가능한 구조 설계 원칙

### 점수 계산 로직 확장성

**설계 원칙**:

1. **운동별 평가 기준표를 DB에 저장**: 새로운 운동 추가 시 코드 수정 없이 DB만 업데이트
2. **체중 대비 비율 계산 지원**: 스쿼트 등 체중 대비 1RM 평가를 처음부터 지원
3. **계산 타입 확장 가능**: 절대값(`ABSOLUTE`), 체중 대비 비율(`BODY_WEIGHT_RATIO`) 외에도 확장 가능
4. **기본값 우선 사용**: Phase 3에서는 기본 운동 기준표만 사용, 커스터마이징은 Phase 5에서

**점수 계산 프로세스**:

```
1. 평가 항목 입력 (운동명, 측정값, 회원 체중)
2. ScoringCriteria에서 해당 운동의 기준표 조회
3. calculationType에 따라 계산:
   - ABSOLUTE: 측정값을 그대로 사용
   - BODY_WEIGHT_RATIO: 측정값 / 체중 = 비율 계산
4. scoringRanges에서 해당하는 점수 찾기
5. 카테고리별 평균 점수 계산
6. AssessmentWeightConfig에서 가중치 조회 (기본값 사용)
7. 가중 평균으로 종합 점수 계산
8. AssessmentGradeConfig에서 등급 조회 (기본값 사용)
```

**예시: 스쿼트 점수 계산**

```
회원 체중: 70kg
스쿼트 1RM: 100kg
→ 비율: 100 / 70 = 1.43배
→ ScoringCriteria에서 1.0 ~ 1.3 범위 찾기
→ 점수: 70점 (중급)
```

### 데이터베이스 구조 확장성

**Phase 3에서 생성할 테이블**:

- `scoring_criteria`: 운동별 평가 기준표 (기본 운동만 입력)
- `assessment_weight_configs`: 가중치 설정 (전역 기본값만 입력)
- `assessment_grade_configs`: 등급 기준 (전역 기본값만 입력)

**Phase 5에서 추가할 기능**:

- 트레이너별 개인 설정 저장 (`userId` 필드 활용)
- 커스터마이징 UI/API
- 설정 관리 기능

---

## 🔗 관련 문서

- `docs/FEEDBACK_IMPLEMENTATION_PLAN.md` - 상세 구현 계획서
- `PROJECT_PLAN.md` - 프로젝트 전체 계획서

---

**작성일**: 2026-01-06
**작성자**: AI Assistant
**상태**: 피드백 반영 계획 수립 완료, 구현 대기 중
